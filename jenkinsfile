pipeline { 
    agent any 
     
    environment { 
        PYTHON_VERSION = '3.12' 
    } 
     
    stages { 
        stage('Checkout') { 
            steps { 
                checkout([
                    $class: 'GitSCM',
                    branches: [[name: '*/main']],
                    userRemoteConfigs: [[
                        url: 'https://github.com/sabarichandruc/playwright_tests.git'
                    ]]
                ])
            } 
        } 
         
        stage('Setup Python Environment') { 
            steps { 
                bat ''' 
                    python -m venv venv 
                    call venv\\Scripts\\activate.bat 
                    pip install --upgrade pip setuptools wheel
                    pip install -r requirement.txt 
                ''' 
            } 
        } 
         
        stage('Install Playwright Browsers') { 
            steps { 
                bat ''' 
                    call venv\\Scripts\\activate.bat 
                    playwright install chromium 
                    playwright install-deps chromium 
                ''' 
            } 
        } 
         
        stage('Run Tests') { 
            steps { 
                bat ''' 
                    call venv\\Scripts\\activate.bat 
                    pytest tests/ 
                ''' 
            } 
        } 
    } 
     
    post { 
        always { 
            bat 'rmdir /s /q venv'
            cleanWs() 
        }
        
        success {
            echo 'âœ“ All Playwright tests passed successfully!'
        }
    } 
}